<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Georgyyy's Assistant â€” Powered by DeepSeek</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:         #050b14;
      --panel:      #080f1c;
      --surface:    #0c1628;
      --surface2:   #111e33;
      --border:     #1a2d4a;
      --border2:    #1f3660;
      --accent:     #00d4aa;
      --accent-dim: rgba(0,212,170,0.12);
      --signal:     #00aaff;
      --signal-dim: rgba(0,170,255,0.10);
      --warn:       #ff6b35;
      --warn-dim:   rgba(255,107,53,0.12);
      --caution:    #f5c518;
      --text:       #c8d8f0;
      --text-dim:   #6b85a8;
      --text-head:  #e8f2ff;
      --mono:       'IBM Plex Mono', monospace;
      --sans:       'IBM Plex Sans', sans-serif;
      --grid-color: rgba(0,170,255,0.04);
      --user-bubble: #0d2040;
      --bot-bubble:  #0c1e35;
    }

    body {
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
      background-image:
        linear-gradient(var(--grid-color) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
      background-size: 40px 40px;
      overflow: hidden;
    }

    /* â”€â”€ TOP BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      border-bottom: 1px solid var(--border);
      background: rgba(5,11,20,0.85);
      backdrop-filter: blur(10px);
      flex-shrink: 0;
      z-index: 10;
    }

    .brand { display: flex; align-items: center; gap: 0.75rem; }

    .brand-icon {
      width: 34px; height: 34px;
      background: var(--accent);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      font-family: var(--mono); font-weight: 600; font-size: 0.85rem;
      color: #050b14; flex-shrink: 0;
    }

    .brand-name {
      font-family: var(--mono); font-size: 0.82rem; font-weight: 600;
      letter-spacing: 0.14em; text-transform: uppercase; color: var(--text-head);
    }

    .brand-sub { font-size: 0.65rem; color: var(--text-dim); font-family: var(--mono); letter-spacing: 0.08em; }

    .topbar-right { display: flex; align-items: center; gap: 1.25rem; }

    .live-badge {
      display: flex; align-items: center; gap: 0.4rem;
      font-family: var(--mono); font-size: 0.65rem;
      color: var(--accent); letter-spacing: 0.1em;
    }

    .live-dot {
      width: 6px; height: 6px;
      background: var(--accent); border-radius: 50%;
      animation: pulse 1.8s ease-in-out infinite;
    }

    @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.25; } }

    .clock { font-family: var(--mono); font-size: 0.75rem; color: var(--text-dim); }

    .model-badge {
      font-family: var(--mono); font-size: 0.6rem; letter-spacing: 0.1em;
      text-transform: uppercase; padding: 0.25rem 0.6rem;
      border: 1px solid rgba(0,170,255,0.3); border-radius: 4px;
      color: var(--signal); background: var(--signal-dim);
    }

    .clear-btn-top {
      font-family: var(--mono); font-size: 0.6rem; letter-spacing: 0.08em;
      text-transform: uppercase; padding: 0.25rem 0.7rem;
      border: 1px solid var(--border2); border-radius: 4px;
      background: none; color: var(--text-dim); cursor: pointer;
      transition: color 0.15s, border-color 0.15s;
    }

    .clear-btn-top:hover { color: var(--warn); border-color: rgba(255,107,53,0.4); }

    /* â”€â”€ CHAT AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-wrapper {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      max-width: 860px;
      width: 100%;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem 0;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      scroll-behavior: smooth;
    }

    .chat-messages::-webkit-scrollbar { width: 4px; }
    .chat-messages::-webkit-scrollbar-track { background: transparent; }
    .chat-messages::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }

    /* â”€â”€ MESSAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .msg-row {
      display: flex;
      gap: 0.75rem;
      align-items: flex-start;
      animation: fadeSlideIn 0.25s ease;
    }

    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .msg-row.user { flex-direction: row-reverse; }

    .avatar {
      width: 30px; height: 30px; border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      font-family: var(--mono); font-size: 0.65rem; font-weight: 600;
      flex-shrink: 0; margin-top: 2px;
    }

    .avatar.bot { background: var(--accent); color: #050b14; }
    .avatar.user { background: var(--signal-dim); border: 1px solid rgba(0,170,255,0.3); color: var(--signal); }

    .bubble-wrap { display: flex; flex-direction: column; gap: 0.3rem; max-width: 72%; }
    .msg-row.user .bubble-wrap { align-items: flex-end; }

    .bubble {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      font-size: 0.87rem;
      line-height: 1.6;
      word-break: break-word;
      position: relative;
    }

    .bubble.bot {
      background: var(--bot-bubble);
      border: 1px solid var(--border);
      color: var(--text-head);
      border-top-left-radius: 2px;
    }

    .bubble.user {
      background: var(--user-bubble);
      border: 1px solid var(--border2);
      color: var(--text-head);
      border-top-right-radius: 2px;
    }

    .msg-meta {
      display: flex; align-items: center; gap: 0.5rem;
    }

    .msg-time {
      font-family: var(--mono); font-size: 0.58rem; color: var(--text-dim);
    }

    .copy-btn {
      background: none; border: none; cursor: pointer;
      font-size: 0.65rem; color: var(--text-dim); padding: 0;
      font-family: var(--mono); letter-spacing: 0.05em;
      transition: color 0.15s;
      display: flex; align-items: center; gap: 0.25rem;
    }

    .copy-btn:hover { color: var(--accent); }
    .copy-btn.copied { color: var(--accent); }

    /* â”€â”€ TYPING INDICATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .typing-row { display: flex; gap: 0.75rem; align-items: flex-start; }

    .typing-bubble {
      background: var(--bot-bubble);
      border: 1px solid var(--border);
      border-radius: 8px; border-top-left-radius: 2px;
      padding: 0.75rem 1rem;
      display: flex; align-items: center; gap: 0.3rem;
    }

    .typing-dot {
      width: 5px; height: 5px;
      background: var(--accent); border-radius: 50%;
      animation: typingBounce 1.2s ease-in-out infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typingBounce {
      0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
      40% { transform: translateY(-5px); opacity: 1; }
    }

    /* â”€â”€ WELCOME STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .welcome-state {
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      flex: 1; text-align: center; gap: 1rem;
      padding: 2rem;
    }

    .welcome-icon {
      width: 56px; height: 56px;
      background: var(--accent-dim);
      border: 1px solid rgba(0,212,170,0.25);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem;
    }

    .welcome-title {
      font-family: var(--mono); font-size: 1rem; font-weight: 600;
      letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-head);
    }

    .welcome-sub {
      font-family: var(--mono); font-size: 0.68rem;
      color: var(--text-dim); letter-spacing: 0.06em; max-width: 340px;
      line-height: 1.8;
    }

    .suggestion-chips {
      display: flex; flex-wrap: wrap; gap: 0.5rem;
      justify-content: center; margin-top: 0.5rem;
    }

    .chip {
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 20px;
      padding: 0.4rem 0.9rem;
      font-family: var(--mono); font-size: 0.65rem;
      color: var(--text); cursor: pointer;
      transition: border-color 0.15s, color 0.15s, background 0.15s;
      letter-spacing: 0.04em;
    }

    .chip:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-dim); }

    /* â”€â”€ INPUT BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .input-bar {
      padding: 1rem 0 1.5rem;
      flex-shrink: 0;
    }

    .input-inner {
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 10px;
      display: flex; align-items: flex-end; gap: 0.6rem;
      padding: 0.7rem 0.7rem 0.7rem 1rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .input-inner:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0,212,170,0.07);
    }

    #chatInput {
      flex: 1; background: none; border: none; outline: none;
      font-family: var(--sans); font-size: 0.87rem;
      color: var(--text-head); resize: none;
      min-height: 22px; max-height: 140px;
      line-height: 1.5; padding: 0;
      overflow-y: auto;
    }

    #chatInput::placeholder { color: var(--text-dim); }

    #chatInput::-webkit-scrollbar { width: 3px; }
    #chatInput::-webkit-scrollbar-thumb { background: var(--border2); }

    .send-btn {
      width: 36px; height: 36px; flex-shrink: 0;
      background: var(--accent); border: none; border-radius: 7px;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: opacity 0.15s, transform 0.15s;
      color: #050b14;
    }

    .send-btn:hover { opacity: 0.82; transform: translateY(-1px); }
    .send-btn:active { transform: translateY(0); }
    .send-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }

    .send-btn svg { width: 16px; height: 16px; }

    .input-hint {
      font-family: var(--mono); font-size: 0.58rem; color: var(--text-dim);
      letter-spacing: 0.06em; margin-top: 0.5rem; text-align: right;
    }

    /* â”€â”€ API KEY MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(5,11,20,0.92);
      backdrop-filter: blur(6px);
      display: flex; align-items: center; justify-content: center;
      z-index: 100;
    }

    .modal-overlay.hidden { display: none; }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border2);
      border-radius: 12px;
      padding: 2rem;
      max-width: 420px; width: 90%;
      display: flex; flex-direction: column; gap: 1.25rem;
    }

    .modal-header { display: flex; align-items: center; gap: 0.75rem; }

    .modal-icon {
      width: 36px; height: 36px;
      background: var(--accent-dim); border: 1px solid rgba(0,212,170,0.25);
      border-radius: 8px; display: flex; align-items: center; justify-content: center;
      font-size: 1rem;
    }

    .modal-title {
      font-family: var(--mono); font-size: 0.85rem; font-weight: 600;
      letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-head);
    }

    .modal-desc {
      font-family: var(--mono); font-size: 0.68rem; color: var(--text-dim);
      line-height: 1.7; letter-spacing: 0.04em;
    }

    .modal-desc a { color: var(--signal); text-decoration: none; }
    .modal-desc a:hover { text-decoration: underline; }

    .modal input[type="password"] {
      width: 100%; background: var(--bg);
      border: 1px solid var(--border2); border-radius: 6px;
      padding: 0.75rem 1rem; color: var(--text-head);
      font-family: var(--mono); font-size: 0.83rem; outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .modal input[type="password"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0,212,170,0.07);
    }

    .modal input[type="password"]::placeholder { color: var(--text-dim); }

    .modal-btn {
      width: 100%; background: var(--accent); color: #050b14;
      border: none; border-radius: 6px; padding: 0.75rem;
      font-family: var(--mono); font-weight: 600; font-size: 0.8rem;
      letter-spacing: 0.08em; cursor: pointer;
      transition: opacity 0.15s;
    }

    .modal-btn:hover { opacity: 0.82; }

    .modal-error {
      font-family: var(--mono); font-size: 0.65rem;
      color: var(--warn); letter-spacing: 0.06em;
      display: none;
    }

    /* â”€â”€ BOTTOM STATUS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .status-bar {
      padding: 0.4rem 2rem;
      border-top: 1px solid var(--border);
      background: rgba(5,11,20,0.6);
      display: flex; justify-content: space-between; align-items: center;
      flex-shrink: 0;
    }

    .status-left, .status-right {
      font-family: var(--mono); font-size: 0.58rem;
      color: var(--text-dim); letter-spacing: 0.08em;
    }

    .status-left span { color: var(--accent); }
  </style>
</head>
<body>


<!-- TOP BAR -->
<div class="topbar">
  <div class="brand">
    <div class="brand-icon">AI</div>
    <div>
      <div class="brand-name">Personal Assistant</div>
      <div class="brand-sub">Powered by DeepSeek</div>
    </div>
  </div>
  <div class="topbar-right">
    <div class="model-badge" id="modelBadge">deepseek-chat</div>
    <div class="live-badge"><div class="live-dot"></div>ONLINE</div>
    <div class="clock" id="clock">--:--:--</div>
    <button class="clear-btn-top" onclick="clearChat()">CLEAR CHAT</button>
    <button class="clear-btn-top" onclick="showAbout()">ABOUT</button>
  </div>
</div>

<!-- CHAT -->
<div class="chat-wrapper">
  <div class="chat-messages" id="chatMessages">
    <!-- Welcome State -->
    <div class="welcome-state" id="welcomeState">
      <div class="welcome-icon">ğŸ¤–</div>
      <div class="welcome-title">Assistant Online</div>
      <div class="welcome-sub">
        Your personal AI assistant powered by DeepSeek.<br/>
        Ask me anything â€” I'm here to help.
      </div>
      <div class="suggestion-chips">
        <div class="chip" onclick="useChip(this)">Summarize my tasks</div>
        <div class="chip" onclick="useChip(this)">Draft an email</div>
        <div class="chip" onclick="useChip(this)">Explain a concept</div>
        <div class="chip" onclick="useChip(this)">Help me plan my day</div>
        <div class="chip" onclick="useChip(this)">Write code for me</div>
      </div>
    </div>
  </div>

  <!-- INPUT BAR -->
  <div class="input-bar">
    <div class="input-inner">
      <textarea id="chatInput" rows="1" placeholder="Message your assistant..." autocomplete="off"></textarea>
      <button class="send-btn" id="sendBtn" onclick="sendMessage()" title="Send">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </div>
    <div class="input-hint">ENTER to send &nbsp;Â·&nbsp; SHIFT+ENTER for new line</div>
  </div>
</div>

<!-- ABOUT MODAL -->
<div class="modal-overlay hidden" id="aboutModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-icon">â„¹ï¸</div>
      <div class="modal-title">About This Bot</div>
    </div>
    <div class="modal-desc">
      This is a simple chat interface built by Georgyyyy.
      It uses a Flask backend to proxy requests to the DeepSeek API,
      keeping the API key secret. The frontend is static HTML/JS;
      feel free to modify and extend it.
      for any questions or suggestions, reach out to me on whatsapp +254118337111 <a href="https://twitter.com/Georgyyyyy" target="_blank">@Georgyyyyy</a>.
    </div>
    <button class="modal-btn" onclick="hideAbout()">CLOSE</button>
  </div>
</div>

<!-- STATUS BAR -->
<div class="status-bar">
  <div class="status-left">MESSAGES: <span id="msgCount">0</span></div>
  <div class="status-right" id="statusText">READY</div>
</div>

<script>
  // â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const API_URL = '/chat'; // proxy endpoint served by backend
  const SYSTEM_PROMPT = `You are a smart, efficient personal assistant. Be concise, helpful, and direct. Format responses clearly. Use markdown when helpful (bullet points, code blocks, bold). Today's date is ${new Date().toDateString()}.`;

  // â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let history = JSON.parse(localStorage.getItem('ds_history') || '[]');
  let isTyping = false;
  let msgCount = 0;

  // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function init() {
    loadHistory();
    updateClock();
    setInterval(updateClock, 1000);
    autoResize();
  }

  function showAbout() {
    document.getElementById('aboutModal').classList.remove('hidden');
  }

  function hideAbout() {
    document.getElementById('aboutModal').classList.add('hidden');
  }

  // â”€â”€ CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateClock() {
    document.getElementById('clock').textContent =
      new Date().toLocaleTimeString('en-GB', { hour12: false });
  }

  // â”€â”€ HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function saveHistory() {
    localStorage.setItem('ds_history', JSON.stringify(history));
  }

  function loadHistory() {
    if (history.length === 0) return;
    document.getElementById('welcomeState').remove();
    history.forEach(msg => {
      if (msg.role !== 'system') {
        renderMessage(msg.role === 'user' ? 'user' : 'bot', msg.content, false);
      }
    });
    updateMsgCount();
  }

  // â”€â”€ RENDER MESSAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderMessage(role, content, animate = true) {
    const container = document.getElementById('chatMessages');

    // Remove welcome state if present
    const ws = document.getElementById('welcomeState');
    if (ws) ws.remove();

    const time = new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
    const isBot = role === 'bot';

    const row = document.createElement('div');
    row.className = `msg-row ${role}`;
    if (!animate) row.style.animation = 'none';

    const avatarLabel = isBot ? 'AI' : 'ME';
    const avatarClass = isBot ? 'bot' : 'user';

    row.innerHTML = `
      <div class="avatar ${avatarClass}">${avatarLabel}</div>
      <div class="bubble-wrap">
        <div class="bubble ${role}">${formatContent(content)}</div>
        <div class="msg-meta">
          <span class="msg-time">${time}</span>
          <button class="copy-btn" onclick="copyMsg(this, ${JSON.stringify(content)})">â˜ COPY</button>
        </div>
      </div>
    `;

    container.appendChild(row);
    container.scrollTop = container.scrollHeight;
    return row;
  }

  // â”€â”€ FORMAT CONTENT (basic markdown) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function formatContent(text) {
    text = text
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');

    // Code blocks
    text = text.replace(/```(\w+)?\n?([\s\S]*?)```/g, (_, lang, code) =>
      `<pre style="background:var(--bg);border:1px solid var(--border);border-radius:5px;padding:0.75rem;margin:0.5rem 0;overflow-x:auto;font-family:var(--mono);font-size:0.78rem;line-height:1.5;color:var(--accent);">${code.trim()}</pre>`
    );

    // Inline code
    text = text.replace(/`([^`]+)`/g,
      `<code style="background:var(--bg);border:1px solid var(--border);border-radius:3px;padding:0.1em 0.35em;font-family:var(--mono);font-size:0.82em;color:var(--signal);">$1</code>`
    );

    // Bold
    text = text.replace(/\*\*(.+?)\*\*/g, '<strong style="color:var(--text-head);">$1</strong>');

    // Bullets
    text = text.replace(/^[-*] (.+)/gm, '<li style="margin-left:1rem;margin-bottom:0.2rem;">$1</li>');
    text = text.replace(/(<li[\s\S]*<\/li>)/g, '<ul style="list-style:disc;padding-left:0.5rem;margin:0.3rem 0;">$1</ul>');

    // Line breaks
    text = text.replace(/\n/g, '<br/>');

    return text;
  }

  // â”€â”€ TYPING INDICATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showTyping() {
    const container = document.getElementById('chatMessages');
    const row = document.createElement('div');
    row.className = 'typing-row';
    row.id = 'typingIndicator';
    row.innerHTML = `
      <div class="avatar bot">AI</div>
      <div class="typing-bubble">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    `;
    container.appendChild(row);
    container.scrollTop = container.scrollHeight;
  }

  function hideTyping() {
    const el = document.getElementById('typingIndicator');
    if (el) el.remove();
  }

  // â”€â”€ SEND MESSAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function sendMessage() {
    const input = document.getElementById('chatInput');
    const text = input.value.trim();
    if (!text || isTyping) return;

    if (!apiKey) {
      document.getElementById('apiModal').classList.remove('hidden');
      return;
    }

    input.value = '';
    input.style.height = 'auto';
    isTyping = true;
    document.getElementById('sendBtn').disabled = true;
    document.getElementById('statusText').textContent = 'THINKING...';

    // Add user message
    renderMessage('user', text);
    history.push({ role: 'user', content: text });
    updateMsgCount();

    showTyping();

    try {
      const messages = [
        { role: 'system', content: SYSTEM_PROMPT },
        ...history.slice(-20) // keep last 20 messages for context
      ];

      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ message: text })
      });

      hideTyping();

      if (!response.ok) {
        const err = await response.json().catch(() => ({}));
        throw new Error(err.error?.message || `API error: ${response.status}`);
      }

      const data = await response.json();
      const reply = data.choices?.[0]?.message?.content || 'No response received.';

      renderMessage('bot', reply);
      history.push({ role: 'assistant', content: reply });
      saveHistory();
      updateMsgCount();
      document.getElementById('statusText').textContent = 'READY';

    } catch (err) {
      hideTyping();
      renderMessage('bot', `âš  Error: ${err.message}`);
      document.getElementById('statusText').textContent = 'ERROR';
      console.error(err);
    }

    isTyping = false;
    document.getElementById('sendBtn').disabled = false;
    input.focus();
  }

  // â”€â”€ COPY MESSAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function copyMsg(btn, text) {
    navigator.clipboard.writeText(text).then(() => {
      btn.textContent = 'âœ“ COPIED';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'â˜ COPY';
        btn.classList.remove('copied');
      }, 1800);
    });
  }

  // â”€â”€ CLEAR CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function clearChat() {
    if (!confirm('Clear all chat history?')) return;
    history = [];
    saveHistory();
    const container = document.getElementById('chatMessages');
    container.innerHTML = `
      <div class="welcome-state" id="welcomeState">
        <div class="welcome-icon">ğŸ¤–</div>
        <div class="welcome-title">Assistant Online</div>
        <div class="welcome-sub">Your personal AI assistant powered by DeepSeek.<br/>Ask me anything â€” I'm here to help.</div>
        <div class="suggestion-chips">
          <div class="chip" onclick="useChip(this)">Summarize my tasks</div>
          <div class="chip" onclick="useChip(this)">Draft an email</div>
          <div class="chip" onclick="useChip(this)">Explain a concept</div>
          <div class="chip" onclick="useChip(this)">Help me plan my day</div>
          <div class="chip" onclick="useChip(this)">Write code for me</div>
        </div>
      </div>`;
    msgCount = 0;
    updateMsgCount();
    document.getElementById('statusText').textContent = 'READY';
  }

  // â”€â”€ SUGGESTION CHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function useChip(chip) {
    document.getElementById('chatInput').value = chip.textContent;
    document.getElementById('chatInput').focus();
  }

  // â”€â”€ COUNTERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateMsgCount() {
    const userMsgs = history.filter(m => m.role === 'user').length;
    document.getElementById('msgCount').textContent = userMsgs;
  }

  // â”€â”€ AUTO RESIZE TEXTAREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function autoResize() {
    const ta = document.getElementById('chatInput');
    ta.addEventListener('input', () => {
      ta.style.height = 'auto';
      ta.style.height = Math.min(ta.scrollHeight, 140) + 'px';
    });
  }

  // â”€â”€ KEYBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener('keydown', e => {
    const input = document.getElementById('chatInput');
    if (e.key === 'Enter' && !e.shiftKey && document.activeElement === input) {
      e.preventDefault();
      sendMessage();
    }
  });

  // â”€â”€ API KEY MODAL ENTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('apiKeyInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') saveApiKey();
  });

  init();
</script>
</body>
</html>
